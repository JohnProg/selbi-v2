machine:
  node:
    version: 4.4.4

dependencies:
  override:
    - npm install -g mocha
    - npm install -g firebase-tools
    - cd selbi-backend && npm install
    - cd selbi-stripe-worker && npm install

test:
  override:
    - cd selbi-backend && npm test
    - cd selbi-stripe-worker && npm test

deployment:
  develop:
    branch: develop
    commands:
      - cd selbi-backend && firebase deploy --project selbi-develop
      - cd selbi-backend && firebase deploy --project selbi-staging
  production:
    branch: production
    commands:
      - cd selbi-backend && firebase use selbi-production --token "$FIREBASE_TOKEN"

