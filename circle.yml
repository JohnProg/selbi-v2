machine:
  node:
    version: 4.4.4

dependencies:
  override:
    - cd selbi-backend && npm install --dev
    - cd ..
    - cd selbi-stripe-worker && npm install --dev
    - cd ..

test:
  override:
    - cd selbi-backend && npm test
    - cd ..
    - cd selbi-stripe-worker && npm test
    - cd ..

deployment:
  staging:
    branch: staging
    commands:
      - cd selbi-backend
      - firebase use selbi-staging --token "$FIREBASE_TOKEN"
      - firebase deploy --token "$FIREBASE_TOKEN"
      - cd ..
  production:
    branch: master
    commands:
      - cd selbi-backend
      - firebase use selbi-production --token "$FIREBASE_TOKEN"
      - firebase deploy --token "$FIREBASE_TOKEN"
      - cd ..
